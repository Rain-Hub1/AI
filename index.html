<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA Conversacional</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { padding: 15px; background: #1f1f1f; border-bottom: 2px solid #00ff41; text-align: center; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 12px; border-radius: 8px; max-width: 80%; }
        .user { align-self: flex-end; background: #0056b3; }
        .ia { align-self: flex-start; background: #333; }
        .debug { font-size: 10px; color: #888; display: block; margin-top: 5px; }
        #input-area { padding: 20px; background: #1f1f1f; display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; border-radius: 5px; border: 1px solid #444; background: #222; color: white; outline: none; }
        button { padding: 10px 20px; background: #00ff41; border: none; color: black; font-weight: bold; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <strong>IA TREINADA VIA MOBILE</strong>
    <div id="status" style="font-size: 12px; color: #ffaa00;">Conectando...</div>
</header>

<div id="chat">
    <div class="msg ia">Olá! Digite algo que você me ensinou no Pydroid.</div>
</div>

<div id="input-area">
    <input type="text" id="user-input" placeholder="Escreva aqui..." onkeypress="if(event.key==='Enter') enviar()">
    <button onclick="enviar()">ENVIAR</button>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDJN4ylUCR3GFY-6G-oHIdOKlrLPLYb0OE",
      authDomain: "chat-conversation-71277.firebaseapp.com",
      projectId: "chat-conversation-71277",
      storageBucket: "chat-conversation-71277.firebasestorage.app",
      messagingSenderId: "995855170501",
      appId: "1:995855170501:web:6d51bd110f166fb93469ac",
      databaseURL: "https://chat-conversation-71277-default-rtdb.firebaseio.com"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let vocab = {};
    let gramatica = {};
    let invVocab = {};

    // Sincroniza o "Cérebro"
    db.ref('ia_cerebro').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            vocab = data.vocabulario || {};
            gramatica = data.gramatica || {};
            invVocab = {};
            for (let word in vocab) { invVocab[vocab[word]] = word; }
            document.getElementById('status').innerText = "ONLINE: " + Object.keys(vocab).length + " tokens carregados.";
            document.getElementById('status').style.color = "#00ff41";
        }
    });

    function enviar() {
        const input = document.getElementById('user-input');
        const text = input.value.trim().toLowerCase();
        if (!text) return;

        addMsg(input.value, 'user');
        input.value = "";

        const palavras = text.split(" ");
        let idsFound = [];
        let resposta = [];

        palavras.forEach(p => {
            if (vocab[p]) {
                const id = vocab[p];
                idsFound.push(id);
                if (gramatica[id]) {
                    resposta.push(invVocab[gramatica[id]]);
                }
            }
        });

        setTimeout(() => {
            let finalMsg = resposta.length > 0 ? resposta.join(" ") : "Ainda não aprendi essa sequência no Pydroid.";
            addMsg(finalMsg + `<span class="debug">Tokens: ${idsFound.join(", ")}</span>`, 'ia');
        }, 400);
    }

    function addMsg(t, c) {
        const chat = document.getElementById('chat');
        const d = document.createElement('div');
        d.className = `msg ${c}`;
        d.innerHTML = t;
        chat.appendChild(d);
        chat.scrollTop = chat.scrollHeight;
    }
</script>
</body>
</html>
