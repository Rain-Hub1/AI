<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA por Caractere</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { padding: 10px; border-bottom: 1px solid #0f0; text-align: center; background: #111; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; border: 1px solid #333; max-width: 85%; word-wrap: break-word; }
        .user { align-self: flex-end; color: #00bcff; border-color: #00bcff; }
        .ia { align-self: flex-start; color: #0f0; }
        .codes { font-size: 9px; color: #555; display: block; margin-top: 5px; }
        #input-area { padding: 20px; display: flex; gap: 10px; background: #111; }
        input { flex: 1; background: #000; border: 1px solid #0f0; color: #0f0; padding: 10px; outline: none; }
        button { background: #0f0; color: #000; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<header>
    SISTEMA DE CODIFICAÇÃO BINÁRIA/TEXTUAL
    <div id="status" style="font-size: 10px;">Carregando mapa...</div>
</header>

<div id="chat"></div>

<div id="input-area">
    <input type="text" id="user-input" placeholder="Digite algo..." onkeypress="if(event.key==='Enter') enviar()">
    <button onclick="enviar()">SEND</button>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDJN4ylUCR3GFY-6G-oHIdOKlrLPLYb0OE",
      authDomain: "chat-conversation-71277.firebaseapp.com",
      projectId: "chat-conversation-71277",
      storageBucket: "chat-conversation-71277.firebasestorage.app",
      messagingSenderId: "995855170501",
      appId: "1:995855170501:web:6d51bd110f166fb93469ac",
      databaseURL: "https://chat-conversation-71277-default-rtdb.firebaseio.com"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let charMap = {};
    let nextMap = {};
    let invMap = {};

    db.ref('ia_cerebro').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            charMap = data.vocabulario || {};
            nextMap = data.gramatica || {};
            invMap = {};
            for (let char in charMap) { invMap[charMap[char]] = char; }
            document.getElementById('status').innerText = `MODO CARACTERE ATIVO: ${Object.keys(charMap).length} SÍMBOLOS`;
        }
    });

    function enviar() {
        const input = document.getElementById('user-input');
        const text = input.value.toLowerCase();
        if (!text) return;

        addMsg(input.value, 'user', '');
        
        let idsInput = [];
        let respostaIds = [];

        // Converte cada letra em ID e busca o próximo caractere
        for (let char of text) {
            if (charMap[char]) {
                const id = charMap[char];
                idsInput.push(id);
                if (nextMap[id]) {
                    respostaIds.push(invMap[nextMap[id]]);
                }
            }
        }

        setTimeout(() => {
            let respFinal = respostaIds.length > 0 ? respostaIds.join("") : "...";
            addMsg(respFinal, 'ia', 'IDs: ' + idsInput.join(" "));
            input.value = "";
        }, 200);
    }

    function addMsg(txt, cl, debug) {
        const chat = document.getElementById('chat');
        const div = document.createElement('div');
        div.className = `msg ${cl}`;
        div.innerHTML = txt + `<span class="codes">${debug}</span>`;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    }
</script>
</body>
</html>
