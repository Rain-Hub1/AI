<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA do Zero - Interface Web</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Courier New', monospace; 
            background: #0a0a0a; 
            color: #00ff41; 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
        }
        header { 
            padding: 15px; 
            background: #111; 
            border-bottom: 2px solid #00ff41; 
            text-align: center; 
            font-size: 1.2em;
            text-shadow: 0 0 5px #00ff41;
        }
        #status-bar {
            font-size: 0.8em;
            color: #ffaa00;
            margin-top: 5px;
        }
        #chat-window { 
            flex: 1; 
            overflow-y: auto; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
        }
        .msg { 
            max-width: 80%; 
            padding: 10px 15px; 
            border-radius: 5px; 
            word-wrap: break-word;
            position: relative;
        }
        .user { 
            align-self: flex-end; 
            background: #003300; 
            border: 1px solid #00ff41; 
        }
        .ia { 
            align-self: flex-start; 
            background: #1a1a1a; 
            border: 1px solid #444; 
        }
        .tokens {
            display: block;
            font-size: 0.7em;
            color: #888;
            margin-top: 5px;
        }
        #input-container { 
            padding: 20px; 
            background: #111; 
            display: flex; 
            gap: 10px; 
            border-top: 1px solid #333;
        }
        input { 
            flex: 1; 
            background: #000; 
            border: 1px solid #00ff41; 
            color: #00ff41; 
            padding: 12px; 
            outline: none;
        }
        button { 
            background: #00ff41; 
            color: #000; 
            border: none; 
            padding: 0 20px; 
            font-weight: bold; 
            cursor: pointer; 
        }
        button:hover { background: #00cc33; }
    </style>
</head>
<body>

<header>
    SISTEMA DE IA - TOKENS DINÂMICOS
    <div id="status-bar">A aguardar conexão com o Pydroid...</div>
</header>

<div id="chat-window" id="chat">
    <div class="msg ia">Sistema pronto. À espera que o cérebro no Pydroid envie os IDs (00001, 01001)...</div>
</div>

<div id="input-container">
    <input type="text" id="campo-texto" placeholder="Escreve para a IA processar...">
    <button onclick="processar()">ENVIAR</button>
</div>

<script>
    // --- TUA CONFIGURAÇÃO EXATA ---
    const firebaseConfig = {
      apiKey: "AIzaSyDJN4ylUCR3GFY-6G-oHIdOKlrLPLYb0OE",
      authDomain: "chat-conversation-71277.firebaseapp.com",
      projectId: "chat-conversation-71277",
      storageBucket: "chat-conversation-71277.firebasestorage.app",
      messagingSenderId: "995855170501",
      appId: "1:995855170501:web:6d51bd110f166fb93469ac"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let vocabulario = {};
    let gramatica = {};

    // Escuta as atualizações do Pydroid em tempo real
    db.ref('ia_cerebro').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            vocabulario = data.vocabulario || {};
            gramatica = data.gramatica || {};
            document.getElementById('status-bar').innerHTML = 
                `ONLINE | ${Object.keys(vocabulario).length} Palavras Conhecidas | Gramática Ativa`;
            document.getElementById('status-bar').style.color = "#00ff41";
        }
    });

    function processar() {
        const input = document.getElementById('campo-texto');
        const texto = input.value.trim().toLowerCase();
        if (!texto) return;

        adicionarMsg(input.value, 'user');

        // Lógica de Tokenizer no Navegador
        const palavras = texto.split(" ");
        let idsDetetados = [];
        let respostaPalavras = [];

        palavras.forEach(p => {
            if (vocabulario[p]) {
                const idAtual = vocabulario[p];
                idsDetetados.push(idAtual.toString().padStart(5, '0'));

                // Tenta encontrar a sequência aprendida (Gramática)
                if (gramatica[idAtual]) {
                    const idSeguinte = gramatica[idAtual];
                    // Procura qual palavra pertence a esse ID
                    const palavraEncontrada = Object.keys(vocabulario).find(key => vocabulario[key] === idSeguinte);
                    if (palavraEncontrada) respostaPalavras.push(palavraEncontrada);
                }
            } else {
                idsDetetados.push("?????");
            }
        });

        setTimeout(() => {
            let respostaIA = respostaPalavras.length > 0 
                ? respostaPalavras.join(" ") 
                : "Ainda não aprendi o que responder a estes números.";
            
            let debug = "Tokens: " + idsDetetados.join(" ");
            adicionarMsg(respostaIA + `<span class="tokens">${debug}</span>`, 'ia');
        }, 600);

        input.value = "";
    }

    function adicionarMsg(txt, tipo) {
        const win = document.getElementById('chat-window');
        const div = document.createElement('div');
        div.className = `msg ${tipo}`;
        div.innerHTML = txt;
        win.appendChild(div);
        win.scrollTop = win.scrollHeight;
    }
</script>

</body>
</html>
