<!-- frontend/index.html (Nova UI v2) -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA de Aprendizagem</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-icon">ðŸ§ </div>
            <div class="header-text">
                <h1>IA de Aprendizagem</h1>
                <p>Um agente autÃ´nomo para pesquisar e aprender.</p>
            </div>
        </header>

        <div class="input-section">
            <input type="text" id="topic-input" placeholder="Ex: O que Ã© um quasar?">
            <button id="learn-button">Aprender</button>
        </div>

        <div class="results-section">
            <div id="status">Aguardando um tÃ³pico para iniciar a aprendizagem...</div>
            <ul id="results-list"></ul>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'https://ai-test-m37m.onrender.com/aprender';

        const topicInput = document.getElementById('topic-input');
        const learnButton = document.getElementById('learn-button');
        const statusDiv = document.getElementById('status');
        const resultsList = document.getElementById('results-list');

        learnButton.addEventListener('click', async () => {
            const topic = topicInput.value.trim();
            if (!topic) {
                statusDiv.textContent = 'Por favor, digite um tÃ³pico.';
                return;
            }

            learnButton.disabled = true;
            resultsList.innerHTML = '';
            statusDiv.innerHTML = `
                <div class="loader-container">
                    <div class="loader"></div>
                    <span>Processando... O servidor pode estar "acordando", aguarde atÃ© 60s.</span>
                </div>`;

            try {
                // AbortController para timeout mais longo, lidando com o "cold start" do Render
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 60000); // Timeout de 60 segundos

                const response = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic: topic }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`Erro do servidor: ${response.statusText}`);
                }

                const data = await response.json();
                statusDiv.innerHTML = '';

                if (data.error) {
                    statusDiv.textContent = `Erro: ${data.error}`;
                } else {
                    if (data.conhecimento_previo && data.conhecimento_previo.length > 0) {
                        const prevHeader = document.createElement('li');
                        prevHeader.innerHTML = '<strong>ðŸ’¡ Conhecimento PrÃ©vio Encontrado:</strong>';
                        resultsList.appendChild(prevHeader);
                        data.conhecimento_previo.forEach(fato => {
                            const li = document.createElement('li');
                            li.textContent = fato;
                            resultsList.appendChild(li);
                        });
                    }
                    
                    const newHeader = document.createElement('li');
                    newHeader.innerHTML = `<strong>âœ… ${data.mensagem}</strong>`;
                    resultsList.appendChild(newHeader);
                    
                    if (data.fonte) {
                        const fonteLi = document.createElement('li');
                        fonteLi.innerHTML = `ðŸ”— Fonte utilizada: <a href="${data.fonte}" target="_blank" rel="noopener noreferrer">${data.fonte}</a>`;
                        resultsList.appendChild(fonteLi);
                    }
                }

            } catch (error) {
                if (error.name === 'AbortError') {
                    statusDiv.textContent = 'O servidor demorou muito para responder (timeout). Tente novamente.';
                } else {
                    statusDiv.textContent = 'Ocorreu um erro de comunicaÃ§Ã£o com o servidor. Verifique o console do navegador para mais detalhes (F12).';
                }
                console.error('Detalhes do erro:', error);
            } finally {
                learnButton.disabled = false;
            }
        });
    </script>
</body>
</html>
